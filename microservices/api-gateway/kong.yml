_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:5001
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:8080"
            - "https://localhost:8080"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: prometheus
        config:
          per_consumer: true
          status_code_metrics: true
          latency_metrics: true
          bandwidth_metrics: true
          upstream_health_metrics: true
    routes:
      - name: auth-routes
        paths:
          - /auth
        strip_path: false
        
  - name: plants-service
    url: http://plants-service:5002
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:8080"
            - "https://localhost:8080"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: jwt
        config:
          header_names:
            - Authorization
          uri_param_names:
            - jwt
          key_claim_name: iss
          secret_is_base64: false
          anonymous: false
          run_on_preflight: false
      - name: prometheus
        config:
          per_consumer: true
          status_code_metrics: true
          latency_metrics: true
          bandwidth_metrics: true
          upstream_health_metrics: true
    routes:
      - name: plants-routes
        paths:
          - /indoor-plants
          - /user-plants
        strip_path: false
        
  - name: notifications-service
    url: http://notifications-service:5003
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:8080"
            - "https://localhost:8080"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: jwt
        config:
          header_names:
            - Authorization
          uri_param_names:
            - jwt
          key_claim_name: iss
          secret_is_base64: false
          anonymous: false
          run_on_preflight: false
      - name: prometheus
        config:
          per_consumer: true
          status_code_metrics: true
          latency_metrics: true
          bandwidth_metrics: true
          upstream_health_metrics: true
    routes:
      - name: notifications-routes
        paths:
          - /notifications
        strip_path: false

# Global plugins
plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      policy: local
      hide_client_headers: false
      
  - name: request-id
    config:
      header_name: X-Request-ID
      generator: uuid
      
  - name: correlation-id
    config:
      header_name: X-Correlation-ID
      generator: uuid
      
  - name: request-size-limiting
    config:
      allowed_payload_size: 10
      size_unit: megabytes
      
  - name: response-transformer
    config:
      add:
        headers:
          - "X-API-Gateway:Kong"
          - "X-Service-Version:1.0.0"

# Consumers (for JWT)
consumers:
  - username: bloomzy-frontend
    custom_id: bloomzy-frontend
    jwt_secrets:
      - key: bloomzy-frontend
        secret: "your-jwt-secret-key-here"